{% extends 'base.html.twig' %}

{% block title %}Gestion des RÃ©clamations{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1 class="mb-4">ðŸ“© Gestion des RÃ©clamations</h1>

    {% for flash_message in app.flashes('success') %}
        <div class="alert alert-success">{{ flash_message }}</div>
    {% endfor %}
    {% for flash_message in app.flashes('warning') %}
        <div class="alert alert-warning">{{ flash_message }}</div>
    {% endfor %}
    {% for flash_message in app.flashes('error') %}
        <div class="alert alert-danger">{{ flash_message }}</div>
    {% endfor %}

    <form method="post" action="{{ path('app_admin_reclamation_index') }}" id="reclamationForm">
        <div class="row">
            <!-- Liste des rÃ©clamations -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">ðŸ“œ RÃ©clamations</div>
                    <div class="card-body">
                        <button type="button" class="btn btn-success mb-3" onclick="toggleAllCheckboxes('reclamation')">âœ” Tout sÃ©lectionner</button>
                        <div class="list-group" style="max-height: 400px; overflow-y: auto;">
                            {% for reclamation in reclamations %}
                            <div class="list-group-item">
                                <input type="checkbox" name="selected_reclamations[]" value="{{ reclamation.id }}" class="reclamation-checkbox">
                                <strong>{{ reclamation.user.nom }} {{ reclamation.user.prenom }}</strong> | {{ reclamation.sujet }}<br>
                                {{ reclamation.description }}<br>
                                <small>Statut: {{ reclamation.statut }} | Date: {{ reclamation.dateCreation|date('d/m/Y H:i') }}</small>
                            </div>
                            {% else %}
                            <div class="list-group-item">Aucune rÃ©clamation trouvÃ©e.</div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Formulaire de rÃ©ponse -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">ðŸ’¬ RÃ©ponse Ã  la sÃ©lection</div>
                    <div class="card-body">
                        {{ form_start(form) }}
                            {{ form_errors(form) }}
                            {{ form_row(form.message, {'label': 'RÃ©ponse'}) }}
                            {{ form_row(form.submit, {'label': 'Envoyer la rÃ©ponse'}) }}
                        {{ form_end(form) }}
                    </div>
                </div>
            </div>

            <!-- Liste des rÃ©ponses -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">ðŸ“¬ RÃ©ponses envoyÃ©es</div>
                    <div class="card-body">
                        <form method="post" action="{{ path('app_admin_reponse_delete') }}">
                            <button type="button" class="btn btn-success mb-3" onclick="toggleAllCheckboxes('reponse')">âœ” Tout sÃ©lectionner</button>
                            <button type="submit" class="btn btn-danger mb-3">ðŸ—‘ Supprimer sÃ©lection</button>
                            <div class="list-group" style="max-height: 400px; overflow-y: auto;">
                                {% for reponse in reponses %}
                                <div class="list-group-item">
                                    <input type="checkbox" name="selected_reponses[]" value="{{ reponse.id }}" class="reponse-checkbox">
                                    ðŸ“¨ {{ reponse.message }}<br>
                                    <small>EnvoyÃ©e par: {{ reponse.admin.nom }} {{ reponse.admin.prenom }} | Date: {{ reponse.dateReponse|date('d/m/Y H:i') }}</small><br>
                                    <small>AssociÃ©e Ã : {{ reponse.reclamation.sujet }}</small>
                                </div>
                                {% else %}
                                <div class="list-group-item">Aucune rÃ©ponse trouvÃ©e.</div>
                                {% endfor %}
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </form>

<script>
function toggleAllCheckboxes(type) {
    try {
        const checkboxes = document.querySelectorAll(`.${type}-checkbox`);
        if (checkboxes.length === 0) {
            console.warn(`Aucun checkbox trouvÃ© pour le type: ${type}`);
            return;
        }
        const allChecked = Array.from(checkboxes).every(cb => cb.checked);
        checkboxes.forEach(cb => cb.checked = !allChecked);
    } catch (error) {
        console.error('Erreur dans toggleAllCheckboxes:', error);
    }
}

document.querySelector('#reclamationForm').addEventListener('submit', function(e) {
    const checked = document.querySelectorAll('input[name="selected_reclamations[]"]:checked').length;
    if (checked === 0) {
        alert('Veuillez sÃ©lectionner au moins une rÃ©clamation.');
        e.preventDefault();
    }
});
</script>
{% endblock %}